#!/usr/bin/python
# -*- coding: utf-8 -*-

import requests
import base64
import json
import logging
from textwrap import wrap


logging.basicConfig(level=logging.INFO)
log = logging.getLogger(__name__)

def google_safe_browsing_lookup(api_key):
    api = "https://safebrowsing.googleapis.com/v4/threatListUpdates:fetch"

    params = {'key': "{API_KEY}".format(API_KEY=api_key)}

    headers = {
        'Content-Type' : "application/json",
        'User-Agent'   : "Mozilla/5.0"
    }

    data =   {
        "client": {
            "clientId":       "ChromeExtensionMalware",
            "clientVersion":  "1.5.2"
        },
        "listUpdateRequests": [{
            "threatType":      "MALWARE",
            "platformType":    "CHROME",
            "threatEntryType": "CHROME_EXTENSION",
        }]
        }

    response = requests.post(api, params=params, headers=headers, json=data)
    log.debug('Status Code: %d', response.status_code)

    return response.json()



if __name__ == '__main__':
    API_KEY = ''  # Set up an API key
    hashes = google_safe_browsing_lookup(API_KEY)

    for item in hashes['listUpdateResponses']:
        for addition in item['additions']:
            addition = addition['rawHashes']['rawHashes']
            malicious_extensions = base64.b64decode(addition).decode('ascii')
            print(wrap(malicious_extensions, 32))